trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:
# Check Java and Maven versions
- script: |
    echo "Checking Java version:"
    java -version
    echo "Checking Maven version:"
    mvn -version
  displayName: 'Check Java and Maven Versions'

# Run Maven build
- task: Maven@4
  inputs:
    mavenPomFile: 'server/pom.xml'  # Ensure this path is correct
    goals: 'clean package'
    options: '-DskipTests -X -e'  # Enable verbose output

# List the contents of the target directory after Maven build
- script: |
    echo "Contents of the target directory after Maven build:"
    ls -R target || echo "Target directory does not exist."
  displayName: 'List contents of target directory'

# Copy WAR file
- task: CopyFiles@2
  inputs:
    Contents: 'target/**/*.war'
    TargetFolder: '$(Build.ArtifactStagingDirectory)'

# List the contents of the artifact staging directory for debugging
- script: |
    echo "Contents of the artifact staging directory:"
    ls -R $(Build.ArtifactStagingDirectory) || echo "Artifact staging directory does not exist."
  displayName: 'List contents of artifact staging directory'

# Publish Build Artifacts
- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: 'warFile'
    publishLocation: 'Container'

# Deploy to Azure App Service
- task: AzureWebApp@1
  inputs:
    azureSubscription: 'Free Trial (2cee8c2c-05e3-45f6-b58b-38bde49e1643)'
    appType: 'webApp'
    appName: 'ashwinkallingal'
    package: '$(Build.ArtifactStagingDirectory)/**/*.war'
